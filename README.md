# éŸ³å£°AIæ—¥è¨˜ã‚¢ãƒ—ãƒª MVP

éŸ³å£°ã§è©±ã™ã ã‘ã§æ—¥è¨˜ãŒå®Œæˆã—ã€æŒ¯ã‚Šè¿”ã‚Šï¼ˆè¦ç´„ï¼‰ãŒã§ãã‚‹æ—¥è¨˜ã‚¢ãƒ—ãƒªã®MVPï¼ˆMinimum Viable Productï¼‰ã§ã™ã€‚

## âœ¨ æ©Ÿèƒ½

- ğŸ¤ **éŸ³å£°ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦æ—¥è¨˜ã‚’ä½œæˆ
- ğŸ“ **è‡ªå‹•æ–‡å­—èµ·ã“ã—**: OpenAI Whisper APIã«ã‚ˆã‚‹é«˜ç²¾åº¦ãªéŸ³å£°èªè­˜
- ğŸ¤– **AIè¦ç´„**: GPTã«ã‚ˆã‚‹è‡ªå‹•è¦ç´„ç”Ÿæˆ
- ğŸ”’ **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·**: PIIï¼ˆå€‹äººè­˜åˆ¥æƒ…å ±ï¼‰ã®è‡ªå‹•æ¤œå‡ºã¨ãƒã‚¹ã‚­ãƒ³ã‚°
  - é›»è©±ç•ªå·ãƒ»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å«ã‚€ã‚¨ãƒ³ãƒˆãƒªã¯è¦ç´„å¯¾è±¡å¤–
- ğŸ·ï¸ **è‡ªå‹•ã‚¿ã‚°ä»˜ä¸**: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§è‡ªå‹•ã‚¿ã‚°æŠ½å‡ºï¼ˆPhase2å¯¾å¿œï¼‰
- ğŸš« **NGã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ¤œå‡º**: ä¸é©åˆ‡ãªãƒˆãƒ”ãƒƒã‚¯ã‚’è‡ªå‹•æ¤œå‡ºã—ã¦ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆPhase2å¯¾å¿œï¼‰
- ğŸ“Š **æœŸé–“è¦ç´„**: æŒ‡å®šæœŸé–“ã®æ—¥è¨˜ã‚’ã¾ã¨ã‚ã¦è¦ç´„
- ğŸ¨ **è¤‡æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**: è¦ç´„ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é¸æŠå¯èƒ½

## ğŸ” Phase1: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–å¯¾å¿œï¼ˆâœ…å®Œäº†ï¼‰

ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªåŒ–ã«å‘ã‘ãŸè„†å¼±æ€§å¯¾ç­–ã‚’å®Ÿæ–½:

### 1. âœ… public_idåŒ–
- **å•é¡Œ**: é€£ç•ªIDï¼ˆ1, 2, 3...ï¼‰ã§æ¨æ¸¬æ”»æ’ƒãŒå¯èƒ½
- **å¯¾ç­–**: ULIDæ¡ç”¨ã§ãƒ©ãƒ³ãƒ€ãƒ IDåŒ–
- **å½±éŸ¿**: API URLå¤‰æ›´ `/entries/123` â†’ `/entries/01HQVXYZ...`

### 2. âœ… éŸ³å£°URLè»¢é€ã®ç¦æ­¢
- **å•é¡Œ**: `/audio?token=...` ã®URLã‚’ã‚³ãƒ”ãƒ¼ã™ã‚Œã°ç¬¬ä¸‰è€…ãŒå†ç”Ÿå¯èƒ½
- **å¯¾ç­–**: Bearerèªè¨¼å¿…é ˆåŒ–
- **å¤‰æ›´**: `/entries/:public_id/audio` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ–°è¨­

### 3. âœ… CORSè¨­å®š
- **ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‹ã‚‰ã®APIå‘¼ã³å‡ºã—ã«å¯¾å¿œ**
- **è¨­å®š**: `CORS_ORIGIN` ç’°å¢ƒå¤‰æ•°ã§åˆ¶å¾¡

### 4. âœ… ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼å¼·åŒ–
- **MIMEã‚¿ã‚¤ãƒ—æ¤œè¨¼**: Content-Typeãƒ˜ãƒƒãƒ€ãƒ¼
- **æ‹¡å¼µå­ãƒã‚§ãƒƒã‚¯**: `.m4a`, `.mp3`, `.wav` ãªã©
- **ãƒã‚¸ãƒƒã‚¯ãƒã‚¤ãƒˆæ¤œè¨¼**: file-typeãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§å®Ÿãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’ç¢ºèª

## ğŸš€ Phase2: æ©Ÿèƒ½å¼·åŒ–å¯¾å¿œï¼ˆâœ…å®Œäº†ï¼‰

### 1. âœ… ã‚¿ã‚¤ãƒˆãƒ«æ¡ç•ª#0å•é¡Œã®ä¿®æ­£
- **å•é¡Œ**: ç¨€ã« `#0` ã®ã‚¿ã‚¤ãƒˆãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹
- **åŸå› **: LAST_INSERT_ID()ã®ç«¶åˆ
- **å¯¾ç­–**: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ + FOR UPDATE ã§æ’ä»–åˆ¶å¾¡

### 2. âœ… è‡ªå‹•ã‚¿ã‚°ä»˜ä¸
- **æ©Ÿèƒ½**: ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã—ã¦è‡ªå‹•ã‚¿ã‚°ä»˜ã‘
- **ãƒ«ãƒ¼ãƒ«**: `worker/resources/tag_rules.txt` ã§å®šç¾©
- **ä¾‹**: ã€Œå‹é”ã¨ãƒ©ãƒ³ãƒã€â†’ `#å‹äºº`, `#é£Ÿäº‹`

### 3. âœ… NGã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ¤œå‡ºå¼·åŒ–
- **æ©Ÿèƒ½**: ä¸é©åˆ‡ãªãƒˆãƒ”ãƒƒã‚¯ãƒ»ãƒ¯ãƒ¼ãƒ‰ã‚’è‡ªå‹•æ¤œå‡º
- **ãƒ«ãƒ¼ãƒ«**: `worker/resources/ng_topics.txt`, `non_save_words.txt`
- **å‹•ä½œ**: æ¤œå‡ºæ™‚ã¯ `content_flagged=1` ã§è¦ç´„å¯¾è±¡å¤–

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

Docker Composeã§ä»¥ä¸‹ã®5ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ§‹æˆï¼š

- **app-api** (Node.js/Express): REST APIã€èªè¨¼ã€ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
- **worker** (Python): STTã€ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ã€AIè¦ç´„ã€ã‚¿ã‚°æŠ½å‡ºã€NGæ¤œå‡º
- **mysql**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **redis**: ã‚¸ãƒ§ãƒ–ã‚­ãƒ¥ãƒ¼
- **minio**: éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆS3äº’æ›ï¼‰

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone https://github.com/pushnanashi2/diary-mvp.git
cd diary-mvp
```

### 2. ç§˜å¯†æƒ…å ±ã®è¨­å®š

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„:

#### `.secrets/db.creds`
```json
{
  "host": "mysql",
  "port": 3306,
  "database": "diary",
  "user": "diary",
  "password": "diary_password"
}
```

#### `.secrets/jwt.secret`
```bash
# è‡ªå‹•ç”Ÿæˆ
openssl rand -base64 48 > .secrets/jwt.secret
```

#### `.secrets/openai.key`
```
sk-proj-YOUR_OPENAI_API_KEY_HERE
```

[OpenAI APIã‚­ãƒ¼å–å¾—](https://platform.openai.com/api-keys)

#### `.secrets/server.crt` ã¨ `.secrets/server.key`ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³: HTTPSç”¨ï¼‰
```bash
# è‡ªå·±ç½²åè¨¼æ˜æ›¸ç”Ÿæˆï¼ˆé–‹ç™ºç”¨ï¼‰
openssl genrsa -out .secrets/server.key 2048
openssl req -new -key .secrets/server.key -out .secrets/server.csr \
  -subj "/C=JP/ST=Tokyo/L=Tokyo/O=DiaryMVP/CN=localhost"
openssl x509 -req -days 365 -in .secrets/server.csr \
  -signkey .secrets/server.key -out .secrets/server.crt
```

### 3. Dockerèµ·å‹•

```bash
docker compose up -d --build
```

### 4. å‹•ä½œç¢ºèª

```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:8000/health

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
curl -X POST http://localhost:8000/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"testpass123"}'

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹
# {"access_token":"eyJhbG..."}
```

## ğŸ“¡ APIä»•æ§˜

### èªè¨¼
- `POST /auth/register` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
- `POST /auth/login` - ãƒ­ã‚°ã‚¤ãƒ³

### ã‚¨ãƒ³ãƒˆãƒªï¼ˆPhase1å¯¾å¿œ: public_idä½¿ç”¨ï¼‰
- `POST /entries` - éŸ³å£°ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- `GET /entries` - ã‚¨ãƒ³ãƒˆãƒªä¸€è¦§
- `GET /entries/:public_id` - ã‚¨ãƒ³ãƒˆãƒªè©³ç´°
- `GET /entries/:public_id/audio` - éŸ³å£°ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ˆBearerå¿…é ˆï¼‰
- `DELETE /entries/:public_id` - ã‚¨ãƒ³ãƒˆãƒªå‰Šé™¤

### æœŸé–“è¦ç´„ï¼ˆPhase1å¯¾å¿œ: public_idä½¿ç”¨ï¼‰
- `POST /summaries` - æœŸé–“è¦ç´„ä½œæˆ
- `GET /summaries` - è¦ç´„ä¸€è¦§
- `GET /summaries/:public_id` - è¦ç´„è©³ç´°
- `POST /summaries/:public_id/retry` - è¦ç´„ãƒªãƒˆãƒ©ã‚¤

è©³ç´°ã¯ [Notion: APIä»•æ§˜ä¸€è¦§](https://www.notion.so/06-API-2e0c742b052381578cd9f027ee91f469) ã‚’å‚ç…§

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- **JWTèªè¨¼**: ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§èªè¨¼å¿…é ˆ
- **PIIä¿è­·**: å€‹äººæƒ…å ±ã‚’è‡ªå‹•æ¤œå‡ºãƒ»ãƒã‚¹ã‚­ãƒ³ã‚°
- **NGã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ¤œå‡º**: ä¸é©åˆ‡ãªå†…å®¹ã‚’è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆPhase2å¯¾å¿œï¼‰
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: ã‚¨ãƒ³ãƒˆãƒªä½œæˆ 30å›/åˆ†ã€è¦ç´„ä½œæˆ 20å›/åˆ†
- **éŸ³å£°URL**: Bearerèªè¨¼å¿…é ˆï¼ˆPhase1å¯¾å¿œï¼‰
- **ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼**: MIMEã‚¿ã‚¤ãƒ— + ãƒã‚¸ãƒƒã‚¯ãƒã‚¤ãƒˆæ¤œè¨¼ï¼ˆPhase1å¯¾å¿œï¼‰

## ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

### âœ… å®Œäº†æ¸ˆã¿
- MVPåŸºæœ¬æ©Ÿèƒ½å®Ÿè£…å®Œäº†
- ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„æ•´å‚™
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å®Œäº†ï¼ˆSQL/è¨­å®š/ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢åˆ†é›¢ï¼‰
- **Phase1: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–å®Œäº†**
  - public_idåŒ–
  - Bearerå¿…é ˆåŒ–
  - CORSè¨­å®š
  - ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼å¼·åŒ–
- **Phase2: æ©Ÿèƒ½å¼·åŒ–å®Œäº†**
  - ã‚¿ã‚¤ãƒˆãƒ«æ¡ç•ª#0å•é¡Œä¿®æ­£
  - è‡ªå‹•ã‚¿ã‚°ä»˜ä¸
  - NGã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ¤œå‡ºå¼·åŒ–

### æ¬¡ã®ä½œæ¥­
- [ ] STTãƒ­ãƒ¼ã‚«ãƒ«åŒ–ï¼ˆãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼å¼·åŒ–ï¼‰
- [ ] ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªé–‹ç™ºï¼ˆiOS/Androidï¼‰
- [ ] ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿APIå®Ÿè£…
- [ ] å¯¾è©±UIå®Ÿè£…

è©³ç´°ã¯ [Notion: èª²é¡Œãƒ»TODO](https://www.notion.so/09-TODO-2e0c742b052381fc9f31e605b8efed50) ã‚’å‚ç…§

## ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªåŒ–ã®æ³¨æ„ç‚¹

### ãƒˆãƒ¼ã‚¯ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
- iOS: Keychain
- Android: EncryptedSharedPreferences

### è¨¼æ˜æ›¸ãƒ”ãƒ³ãƒ‹ãƒ³ã‚°
- ã‚µãƒ¼ãƒãƒ¼è¨¼æ˜æ›¸ã®ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆã‚’ã‚¢ãƒ—ãƒªã«åŸ‹ã‚è¾¼ã¿
- MITMæ”»æ’ƒå¯¾ç­–

### HTTPSå¿…é ˆ
```bash
# æœ¬ç•ªç’°å¢ƒã§ã¯ Let's Encrypt ãªã©ã®æ­£å¼ãªè¨¼æ˜æ›¸ã‚’ä½¿ç”¨
# é–‹ç™ºç”¨ã®è‡ªå·±ç½²åè¨¼æ˜æ›¸ã¯ä¸Šè¨˜ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å‚ç…§
```

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

Private

---

## ğŸ”— é–¢é€£ãƒªãƒ³ã‚¯

- [Notion: é–‹ç™ºãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.notion.so/AI-2e0c742b0523815a904de4b309dc9a18)
- [Notion: ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„](https://www.notion.so/11-2e0c742b05238173901ae9bbd667f4aa)
